from: klotho.aws.Container
to: klotho.aws.Postgres
type: read
inputs:
  ReadOnly:
    name: Read Only
    description: Whether the connection should be read only
    type: boolean
    default: false
resources:
  TaskDefinition:
    ContainerDefinitions[0].Environment:
#      - ${...from.resources:TaskDefinition.ContainerDefinitions[0].Environment}
      - Name: ${to.inputs:Name}_POSTGRES_ENDPOINT
        Value: ${to:outputs.Endpoint}
      - Name: ${to.inputs:Name}_POSTGRES_DATABASE
        Value: ${to:outputs.DatabaseName}
      - Name: ${to.inputs:Name}_POSTGRES_USER
        Value: ${to:outputs.Username}
      - Name: ${to.inputs:Name}_POSTGRES_PASSWORD
        Value: ${to:outputs.Password}
      - Name: ${to.inputs:Name}_POSTGRES_PORT
        Value: ${to:outputs.Port}
      - Name: ${to.inputs:Name}_POSTGRES_CONNECTION_STRING
        Value: ${to.outputs:ConnectionString}
edges:
input_rules:
  - if: ${to.inputs:ReadOnly}
    then:
      - from: ${from.resources:Service}
        to: ${to.resources:RDSInstance}
        action: read
    else:
      - from: ${from.resources:Service}
        to: ${to.resources:RDSInstance}
        action: read_write