id: klotho.aws.Postgres
version: 1.0.0
description: A construct for creating an AWS RDS Postgres database
resources:
  DatabaseInstance:
    type: aws:rds_instance
    name: ${inputs:Name}-db
    properties:
      Engine: postgres
      InstanceClass: ${inputs:InstanceClass}
      AllocatedStorage: ${inputs:AllocatedStorage}
      EngineVersion: ${inputs:EngineVersion}
      MasterUsername: ${inputs:Username}
      MasterUserPassword: ${inputs:Password}
      DBName: ${inputs:DatabaseName}
      Port: ${inputs:Port}

inputs:
  InstanceClass:
    name: Instance Class
    description: The instance class for the database instance
    type: string
    default: db.t3.micro
    validation:
      minLength: 1
      maxLength: 63

  AllocatedStorage:
    name: Allocated Storage
    description: The amount of storage to allocate to the database instance (in GB)
    type: number
    default: 20
    validation:
      minimum: 5
      maximum: 6144

  EngineVersion:
    name: Engine Version
    description: The version of the Postgres engine to use
    type: string
    default: '14.11'
    validation:
      minLength: 1
      maxLength: 63

  Username:
    name: Master Username
    description: The master username for the database instance
    type: string
    default: admin
    validation:
      minLength: 1
      maxLength: 63

  Password:
    name: Master User Password
    description: The master user password for the database instance
    type: string
    validation:
      minLength: 8
      maxLength: 128

  DatabaseName:
    name: Database Name
    description: The name of the database
    type: string
    default: main
    validation:
      minLength: 1
      maxLength: 63

  Port:
    name: Port
    description: The port to expose on the database instance
    type: number
    default: 5432
    validation:
      minimum: 1
      maximum: 65535

  Network:
    name: Network
    description: The network to deploy the database to
    type: Construct<klotho.aws.Network>

outputs:
  Endpoint:
    name: Endpoint
    description: The endpoint of the Postgres database
    value: ${resources:DatabaseInstance#Endpoint}

  Port:
    name: Port
    description: The port of the Postgres database
    value: ${resources:DatabaseInstance#Port}
