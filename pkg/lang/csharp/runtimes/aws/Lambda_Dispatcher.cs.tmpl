using System;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.Hosting;
using ProxyFunction = Amazon.Lambda.AspNetCoreServer.APIGatewayProxyFunction;
using Amazon.Lambda.Core;

namespace KlothoRuntime
{
    public class APIGatewayLambdaDispatcher{{if .Expose.APIGatewayProxyFunction}} : {{.Expose.APIGatewayProxyFunction}}{{end}}
    {
        protected override void Init(IWebHostBuilder builder)
        {
            LambdaLogger.Log("Invoking execution unit: {{.ExecUnitName}}");
{{if .Expose.APIGatewayProxyFunction }}
            base.Init(builder);
{{else if .Expose.StartupClass }}
            builder.UseStartup<{{.Expose.StartupClass}}>();
{{else}}
            LambdaLogger.Log("{{.ExecUnitName}} is No-Op: No handler detected");
{{end}}
        }

        protected override void Init(IHostBuilder builder)
        {
            LambdaLogger.Log("Invoking execution unit: {{.ExecUnitName}}");
{{if .Expose.APIGatewayProxyFunction }}
            base.Init(builder);
{{end}}
        }
    }
}
