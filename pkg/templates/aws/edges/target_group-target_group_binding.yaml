source: aws:target_group
target: kubernetes:target_group_binding
deployment_order_reversed: true
operational_rules:
  - configuration_rules:
      - resource: '{{ .Source }}'
        configuration:
          field: TargetType
          value: ip
  - if: |
      {{- if not (hasDownstream "kubernetes:service" .Target) }}
        false
      {{end}}
      {{ ne (len (fieldValue "Object.Spec.Ports" .Target))  0 }}
    configuration_rules:
      - resource: '{{ .Source }}'
        configuration:
          field: Port
          value: '{{ fieldValue "Object.Spec.Ports[0].Port" (downstream "kubernetes:service" .Target)}}'
      - resource: '{{ .Source }}'
        configuration:
          field: Protocol
          value: '{{ fieldValue "Object.Spec.Ports[0].Protocol" (downstream "kubernetes:service" .Target)}}'
