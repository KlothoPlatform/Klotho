source: aws:ec2_instance
target: aws:elasticache_cluster
operational_rules:
  - if: |
      {{- if (hasDownstream "aws:vpc" .Source) }}
        {{ $ec2Vpc := (downstream "aws:vpc" .Source) }}
        {{ $ecVpc := (downstream "aws:vpc" .Target) }}
        {{- if (ne $ec2Vpc $ecVpc) }}
          true
        {{ else }}
          false
        {{- end }}
      {{ end }}
    steps:
      - resource: '{{ downstream "aws:vpc" .Source }}'
        direction: downstream
        resources:
          - '{{downstream "aws:vpc" .Target}}'
